<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="js/util/string.js"></script>
        <script type="text/javascript" src="js/util/clock.js"></script>
        <script type="text/javascript" src="js/util/time.js"></script>
        <script type="text/javascript" src="js/util/thread.js"></script>
        <script type="text/javascript" src="js/canvas/graph.js"></script>
        <script type="text/javascript" src="js/data/telemetry.js"></script>

        <title>FH5T</title>
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <script>
            window.onbeforeunload = function(){
                const xhttp = new XMLHttpRequest();
                xhttp.open("GET", "stop-server", true);
                xhttp.send();
             }
            window.onload = function() {
                var canvas = document.getElementById("myCanvas");
                console.log("canvas width "+canvas.width);

                startclock();

                const t = new Telemetry("Versuch-1");
                for(var i=1; i<=5; i++) {
                    t.sample(Math.random());
                    //console.log(i + " t is "+t)    
                }
                console.log("first time = "+t.getFirstTime());
                console.log("last time  = "+t.getLastTime());
                drawTelemetryAsBars(t,canvas);

                function receiveData() {
                    t.sample(Math.random());
                    drawTelemetryAsBars(t,canvas);
                }

                for(var i=1; i<=50000; i++) {
                    delay(100*i).then(
                        () => {
                            receiveData();
                        });
                }    
            };

            /* DEMO: function loadDoc() {
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    document.getElementById("demo").innerHTML = this.responseText;
                }
                xhttp.open("GET", "ajax_info.txt", true);
                xhttp.send();
            }*/
        </script>

        <div class="header">
            FH5T - Forza Horizon 5 Telemetry
            <div class="maincontrol">
                <script>
                    function exit() {
                        const xhttp = new XMLHttpRequest();
                        xhttp.open("GET", "stop-server", true);
                        xhttp.send();
                        document.getElementById("content").innerHTML = '<div class="banner">Process stopped</div>';
                        setTimeout(function() {
                            window.close();
                        }, 2000);
                    }
                </script>
                <div id="clock">
                    00:00:00
                </div>                
                <button type="button" class="maincontrol" onclick="exit()">Exit</button>    
            </div>
        </div>

        <div  id="content">
            <div>
                <canvas class="telemetry" id="myCanvas" width="2000" height="200"></canvas>
            </div>    
        </div>


        <footer>
            Author: A. Kolster
        </footer>    
    </body>
</html>
