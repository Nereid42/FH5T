<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="js/util/string.js"></script>
        <script type="text/javascript" src="js/util/clock.js"></script>
        <script type="text/javascript" src="js/util/time.js"></script>
        <script type="text/javascript" src="js/canvas/graph.js"></script>
        <script type="text/javascript" src="js/data/telemetry.js"></script>

        <title>FH5T</title>
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>
        <script>
            function _updateRace() {
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    var race = document.getElementById("race");
                    if(this.responseText == "1") {
                        race.style.backgroundColor = "#30FF30";
                    }
                    else {
                        race.style.backgroundColor = "crimson";
                    }
                }                
                xhttp.open("GET", "datagram", true);
                xhttp.send();
                updateRace();
            }

            function updateRace() {
                setTimeout(_updateRace,10);
            }


            window.onbeforeunload = function(){
                const xhttp = new XMLHttpRequest();
                xhttp.open("GET", "stop-server", true);
                xhttp.send();
             }
            window.onload = function() {
                var canvas1 = document.getElementById("canvas-1");
                var canvas2 = document.getElementById("canvas-2");
                var canvas3 = document.getElementById("canvas-3");

                startclock();

                updateRace();

                const t = new Telemetry("Versuch-1");
                for(var i=1; i<=5; i++) {
                    t.sample(Math.random());
                    //console.log(i + " t is "+t)    
                }
                console.log("first time = "+t.getFirstTime());
                console.log("last time  = "+t.getLastTime());
                drawTelemetryAsBars(t,canvas1);

                function receiveData() {
                    t.sample(Math.random());
                    drawTelemetryAsBars(t,canvas1);
                    drawTelemetryAsBars(t,canvas2);
                    drawTelemetryAsBars(t,canvas3);
                }

                setInterval(receiveData,30);
            };

            /* DEMO: function loadDoc() {
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function() {
                    document.getElementById("demo").innerHTML = this.responseText;
                }
                xhttp.open("GET", "ajax_info.txt", true);
                xhttp.send();
            }*/
        </script>

        <div class="header">
            FH5T - Forza Horizon 5 Telemetry
            <div class="maincontrol">
                <script>
                    function exit() {
                        const xhttp = new XMLHttpRequest();
                        xhttp.open("GET", "stop-server", true);
                        xhttp.send();
                        document.getElementById("content").innerHTML = '<div class="banner">Process stopped</div>';
                        setTimeout(function() {
                            window.close();
                        }, 2000);
                    }
                </script>
                <div id="race">

                </div>
                <div id="clock">
                    00:00:00
                </div>                
                <button type="button" class="maincontrol" onclick="exit()">Exit</button>    
            </div>
        </div>

        <div  id="content">
            <div>
                <canvas class="telemetry" id="canvas-1" width="2000" height="200"></canvas>
                <canvas class="telemetry" id="canvas-2" width="2000" height="200"></canvas>
                <canvas class="telemetry" id="canvas-3" width="2000" height="200"></canvas>
            </div>    
        </div>


        <footer>
            Author: A. Kolster
        </footer>    
    </body>
</html>
